{"version":3,"file":"chargebeehelper.min.js","sources":["../src/chargebeehelper.js"],"sourcesContent":["/* jshint ignore:start */\ndefine(['jquery','core/log','core/ajax'], function($, log, ajax) {\n\n    \"use strict\";\n    log.debug('cbhelper: initialising');\n\n    return {\n\n        instanceprops: null,\n        siteprefix: '',\n        controls: {},\n\n        //pass in config, and register any events\n        init: function(props){\n            //log.debug(props);\n            this.instanceprops=props;\n            this.siteprefix=props.siteprefix;\n            this.gocbcheckoutclass = props.gocbcheckoutclass;\n            this.gocbmanageclass = props.gocbmanageclass;\n            this.registercontrols();\n            this.registerevents();\n        },\n\n        registercontrols: function(){\n            this.controls.togglebutton = $('a.monthlyyearly');\n            this.controls.monthlyplans = $('div.monthly');\n            this.controls.yearlyplans = $('div.yearly');\n        },\n\n        registerevents: function() {\n            var that = this;\n\n            //set up toggle button\n            this.controls.togglebutton.on('click',function(){\n                event.preventDefault();\n                that.controls.monthlyplans.toggleClass('block_poodllclassroom_hidden');\n                that.controls.yearlyplans.toggleClass('block_poodllclassroom_hidden');\n            });\n\n            //set up checkout links\n            $.getScript('https://js.chargebee.com/v2/chargebee.js', function(){\n                var chargebee = Chargebee.init({'site': that.siteprefix});\n\n                //checkout pop open\n                $(\".\" + that.gocbcheckoutclass).on(\"click\", function() {\n                    event.preventDefault();\n                    var clickedthis = this;\n                    var currency = $(this).data('currency');\n                    var billinginterval = $(this).data('billinginterval');\n                    var planid = $(this).data('planid');\n                    var schoolid = $(this).data('schoolid');\n                    var currentsubid = $(this).data('currentsubid');\n                    var method = $(this).data('method');//'get_checkout_existing' or ''\n                    var methodargs = {planid: planid, schoolid: schoolid, currentsubid: currentsubid };\n                    switch(method){\n                        case  \"get_checkout_new\":\n                            methodargs.currency=currency;\n                            methodargs.billinginterval=billinginterval;\n                            break;\n                        case \"get_checkout_existing\":\n                        default:\n                    }\n                    chargebee.openCheckout({\n                        hostedPage: function() {\n                            // Hit the end point that returns hosted page object as response\n                            // serverside we generate a hosted page object , and that auth's and provides deets for CB\n                            // https://apidocs.chargebee.com/docs/api/hosted_pages#checkout_new_subscription\n                            var promises = ajax.call([{\n                                methodname: 'block_poodllclassroom_' + method,\n                                args: methodargs\n                            }]);\n                            return promises[0];\n                        },\n                        loaded: function() {\n                            console.log(\"checkout opened\");\n                        },\n                        error: function() {\n                        },\n                        close: function() {\n                            console.log(\"checkout closed\");\n                        },\n                        success: function(hostedPageId) {\n                            console.log(hostedPageId);\n                            // Hosted page id will be unique token for the checkout that happened\n                            // You can pass this hosted page id to your backend\n                            // and then call our retrieve hosted page api to get subscription details\n                            // https://apidocs.chargebee.com/docs/api/hosted_pages#retrieve_a_hosted_page\n                        },\n                        step: function(value) {\n                            // value -> which step in checkout\n                            console.log(value);\n                        }\n                    });\n                });//on checkout click\n\n                //on manage subscription click\n                $(\"[data-cbaction='ssp']\").on(\"click\", function() {\n                    event.preventDefault();\n                    var clickedthis = this;\n                    var upstreamownerid = $(this).data('upstreamownerid');\n                    var upstreamsubid = $(this).data('upstreamsubid');\n                    switch($(this).data('type')){\n                        case 'paymentsources':\n                            var sectiontype = Chargebee.getPortalSections().PAYMENT_SOURCES;\n                            break;\n\n                        case 'billinghistory':\n                            var sectiontype = Chargebee.getPortalSections().BILLING_HISTORY;\n                            break;\n\n                        case 'subdetails':\n                            var sectiontype = Chargebee.getPortalSections().SUBSCRIPTION_DETAILS;\n                            break;\n\n                        case 'billingaccount':\n                        default:\n                            var sectiontype = false;\n\n                    }\n                    //set the portal session within chargebee\n                    chargebee.setPortalSession(function(){\n                        var promises = ajax.call([{\n                            methodname: 'block_poodllclassroom_create_portal_session',\n                            args: {upstreamownerid: upstreamownerid}\n                        }]);\n                        return promises[0];\n                    });\n\n                    //create the portal;\n                    var cbPortal = chargebee.createChargebeePortal();\n\n                    var callbacks ={\n                        loaded: function() {\n                            console.log(\"manage portal opened\");\n                        },\n\n                        close: function() {\n                            console.log(\"manage portal closed\");\n                        },\n                        visit: function(sectionType) {\n                            console.log(\"manage portal visit\");\n                        },\n                        paymentSourceAdd: function() {\n                            console.log(\"manage portal PSA\");\n                        },\n                        paymentSourceUpdate: function() {\n                            console.log(\"manage portal PSU\");\n                        },\n                        paymentSourceRemove: function() {\n                            console.log(\"manage portal PSR\");\n                        },\n                        subscriptionChanged: function(data) {\n                            console.log(\"manage portal sc\");\n                        },\n                        subscriptionCustomFieldsChanged: function(data) {\n                            console.log(\"manage portal scfc\");\n                        },\n                        subscriptionCancelled: function(data) {\n                            console.log(\"manage portal sub cancelled\");\n                        },\n                        subscriptionPaused: function(data) {\n                            console.log(\"manage portal sub paused\");\n                        },\n                        subscriptionPauseRemoved: function(data) {\n                            console.log(\"manage portal sub pause removed\");\n                        },\n                        subscriptionResumed: function(data) {\n                            console.log(\"manage portal sub resumed\");\n                        },\n                        subscriptionReactivated: function(data) {\n                            console.log(\"manage portal sub reactivated\");\n                        }\n                    };\n                    if(sectiontype!==false) {\n                        var opts ={\n                            sectionType: sectiontype,\n                            params: {\n                                //only meaningful if we are managing a subscription\n                                subscriptionId: upstreamsubid\n                            }\n                        }\n                        cbPortal.openSection(opts, callbacks);\n                    }else{\n                        var forwardOptions={sectionType: Chargebee.getPortalSections().ACCOUNT_DETAILS};\n                       // cbPortal.open(callbacks,forwardOptions);\n                        cbPortal.open(callbacks);\n                    }\n\n                });//on manage subscription click\n\n                //pay outstanding page pop open\n                $(\"[data-cbaction='pay_outstanding']\").on(\"click\", function() {\n                    event.preventDefault();\n                    var clickedthis = this;\n                    var upstreamownerid = $(this).data('upstreamownerid');\n                    var method = 'get_pay_outstanding';\n                    var methodargs = {upstreamownerid: upstreamownerid};\n                    var promises = ajax.call([{\n                        methodname: 'block_poodllclassroom_' + method,\n                        args: methodargs\n                    }]);\n                    promises[0].then(function(hostedpage){\n                        //sends them off to the checkout\n                        window.location.href=hostedpage.url;\n                    });\n                    /*\n                    chargebee.openCheckout({\n                        hostedPage: function() {\n                            // Hit the end point that returns hosted page object as response\n                            // serverside we generate a hosted page object , and that auth's and provides deets for CB\n                            // https://apidocs.chargebee.com/docs/api/hosted_pages#checkout_new_subscription\n                            var promises = ajax.call([{\n                                methodname: 'block_poodllclassroom_' + method,\n                                args: methodargs\n                            }]);\n                            return promises[0];\n                        },\n                        loaded: function() {\n                            console.log(\"pay outstanding opened\");\n                        },\n                        error: function() {\n                        },\n                        close: function() {\n                            console.log(\"pay outstanding closed\");\n                        },\n                        success: function(hostedPageId) {\n                            console.log(hostedPageId);\n                            // Hosted page id will be unique token for the checkout that happened\n                            // You can pass this hosted page id to your backend\n                            // and then call our retrieve hosted page api to get subscription details\n                            // https://apidocs.chargebee.com/docs/api/hosted_pages#retrieve_a_hosted_page\n                        },\n                        step: function(value) {\n                            // value -> which step in checkout\n                            console.log(value);\n                        }\n                    });\n                    */\n                });//on checkout click\n\n            });//end of get script\n\n        }//end of reg events\n    };//end of returned object\n});//total end\n\n"],"names":["define","$","log","ajax","debug","instanceprops","siteprefix","controls","init","props","gocbcheckoutclass","gocbmanageclass","registercontrols","registerevents","togglebutton","monthlyplans","yearlyplans","that","this","on","event","preventDefault","toggleClass","getScript","chargebee","Chargebee","currency","data","billinginterval","planid","schoolid","currentsubid","method","methodargs","openCheckout","hostedPage","call","methodname","args","loaded","console","error","close","success","hostedPageId","step","value","upstreamownerid","upstreamsubid","sectiontype","getPortalSections","PAYMENT_SOURCES","BILLING_HISTORY","SUBSCRIPTION_DETAILS","setPortalSession","cbPortal","createChargebeePortal","callbacks","visit","sectionType","paymentSourceAdd","paymentSourceUpdate","paymentSourceRemove","subscriptionChanged","subscriptionCustomFieldsChanged","subscriptionCancelled","subscriptionPaused","subscriptionPauseRemoved","subscriptionResumed","subscriptionReactivated","opts","params","subscriptionId","openSection","ACCOUNT_DETAILS","open","then","hostedpage","window","location","href","url"],"mappings":"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"}