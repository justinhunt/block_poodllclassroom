{"version":3,"sources":["../src/chargebeehelper.js"],"names":["define","$","log","ajax","debug","instanceprops","changeplanclass","siteprefix","controls","init","props","gocbcheckoutclass","gocbmanageclass","registercontrols","registerevents","togglebutton","monthlyplans","yearlyplans","that","on","event","preventDefault","toggleClass","getScript","chargebee","Chargebee","clickedthis","currency","data","billinginterval","planid","schoolid","currentsubid","method","openCheckout","hostedPage","promises","call","methodname","args","loaded","console","error","close","success","hostedPageId","step","value","upstreamownerid","upstreamsubid","sectiontype","getPortalSections","PAYMENT_SOURCES","BILLING_HISTORY","SUBSCRIPTION_DETAILS","setPortalSession","cbPortal","createChargebeePortal","callbacks","visit","paymentSourceAdd","paymentSourceUpdate","paymentSourceRemove","subscriptionChanged","subscriptionCustomFieldsChanged","subscriptionCancelled","subscriptionPaused","subscriptionPauseRemoved","subscriptionResumed","subscriptionReactivated","opts","sectionType","params","subscriptionId","openSection","ACCOUNT_DETAILS","open"],"mappings":"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","sourcesContent":["/* jshint ignore:start */\ndefine(['jquery','core/log','core/ajax'], function($, log, ajax) {\n\n    \"use strict\";\n    log.debug('cbhelper: initialising');\n\n    return {\n\n        instanceprops: null,\n        changeplanclass: '',\n        siteprefix: '',\n        controls: {},\n\n        //pass in config, and register any events\n        init: function(props){\n            //log.debug(props);\n            this.instanceprops=props;\n            this.changeplanclass=props.changeplanclass;\n            this.siteprefix=props.siteprefix;\n            this.gocbcheckoutclass = props.gocbcheckoutclass;\n            this.gocbmanageclass = props.gocbmanageclass;\n            this.registercontrols();\n            this.registerevents();\n        },\n\n        registercontrols: function(){\n            this.controls.togglebutton = $('a.monthlyyearly');\n            this.controls.monthlyplans = $('div.monthly');\n            this.controls.yearlyplans = $('div.yearly');\n        },\n\n        registerevents: function() {\n            var that = this;\n\n            //set up toggle button\n            this.controls.togglebutton.on('click',function(){\n                event.preventDefault();\n                that.controls.monthlyplans.toggleClass('block_poodllclassroom_hidden');\n                that.controls.yearlyplans.toggleClass('block_poodllclassroom_hidden');\n            });\n\n            //set up checkout links\n            $.getScript('https://js.chargebee.com/v2/chargebee.js', function(){\n                var chargebee = Chargebee.init({'site': that.siteprefix});\n\n                //checkout pop open\n                $(\".\" + that.gocbcheckoutclass).on(\"click\", function() {\n                    event.preventDefault();\n                    var clickedthis = this;\n                    var currency = $(this).data('currency');\n                    var billinginterval = $(this).data('billinginterval');\n                    var planid = $(this).data('planid');\n                    var schoolid = $(this).data('schoolid');\n                    var currentsubid = $(this).data('currentsubid');\n                    var method = $(this).data('method');//'get_checkout_existing' or ''\n                    chargebee.openCheckout({\n                        hostedPage: function() {\n                            // Hit the end point that returns hosted page object as response\n                            // serverside we generate a hosted page object , and that auth's and provides deets for CB\n                            // https://apidocs.chargebee.com/docs/api/hosted_pages#checkout_new_subscription\n                            var promises = ajax.call([{\n                                methodname: 'block_poodllclassroom_' + method,\n                                args: {planid: planid, currency: currency, billinginterval: billinginterval, schoolid: schoolid, currentsubid: currentsubid }\n                            }]);\n                            return promises[0];\n                        },\n                        loaded: function() {\n                            console.log(\"checkout opened\");\n                        },\n                        error: function() {\n                        },\n                        close: function() {\n                            console.log(\"checkout closed\");\n                        },\n                        success: function(hostedPageId) {\n                            console.log(hostedPageId);\n                            // Hosted page id will be unique token for the checkout that happened\n                            // You can pass this hosted page id to your backend\n                            // and then call our retrieve hosted page api to get subscription details\n                            // https://apidocs.chargebee.com/docs/api/hosted_pages#retrieve_a_hosted_page\n                        },\n                        step: function(value) {\n                            // value -> which step in checkout\n                            console.log(value);\n                        }\n                    });\n                });//on checkout click\n\n                //on manage subscription click\n                $(\"[data-cbaction='ssp']\").on(\"click\", function() {\n                    event.preventDefault();\n                    var clickedthis = this;\n                    var upstreamownerid = $(this).data('upstreamownerid');\n                    var upstreamsubid = $(this).data('upstreamsubid');\n                    switch($(this).data('type')){\n                        case 'paymentsources':\n                            var sectiontype = Chargebee.getPortalSections().PAYMENT_SOURCES;\n                            break;\n\n                        case 'billinghistory':\n                            var sectiontype = Chargebee.getPortalSections().BILLING_HISTORY;\n                            break;\n\n                        case 'subdetails':\n                            var sectiontype = Chargebee.getPortalSections().SUBSCRIPTION_DETAILS;\n                            break;\n\n                        case 'billingaccount':\n                        default:\n                            var sectiontype = false;\n\n                    }\n                    //set the portal session within chargebee\n                    chargebee.setPortalSession(function(){\n                        var promises = ajax.call([{\n                            methodname: 'block_poodllclassroom_create_portal_session',\n                            args: {upstreamownerid: upstreamownerid}\n                        }]);\n                        return promises[0];\n                    });\n\n                    //create the portal;\n                    var cbPortal = chargebee.createChargebeePortal();\n\n                    var callbacks ={\n                        loaded: function() {\n                            console.log(\"manage portal opened\");\n                        },\n\n                        close: function() {\n                            console.log(\"manage portal closed\");\n                        },\n                        visit: function(setionType) {\n                            console.log(\"manage portal visit\");\n                        },\n                        paymentSourceAdd: function() {\n                            console.log(\"manage portal PSA\");\n                        },\n                        paymentSourceUpdate: function() {\n                            console.log(\"manage portal PSU\");\n                        },\n                        paymentSourceRemove: function() {\n                            console.log(\"manage portal PSR\");\n                        },\n                        subscriptionChanged: function(data) {\n                            console.log(\"manage portal sc\");\n                        },\n                        subscriptionCustomFieldsChanged: function(data) {\n                            console.log(\"manage portal scfc\");\n                        },\n                        subscriptionCancelled: function(data) {\n                            console.log(\"manage portal sub cancelled\");\n                        },\n                        subscriptionPaused: function(data) {\n                            console.log(\"manage portal sub paused\");\n                        },\n                        subscriptionPauseRemoved: function(data) {\n                            console.log(\"manage portal sub pause removed\");\n                        },\n                        subscriptionResumed: function(data) {\n                            console.log(\"manage portal sub resumed\");\n                        },\n                        subscriptionReactivated: function(data) {\n                            console.log(\"manage portal sub reactivated\");\n                        }\n                    };\n                    if(sectiontype!==false) {\n                        var opts ={\n                            sectionType: sectiontype,\n                            params: {\n                                //only meaningful if we are managing a subscription\n                                subscriptionId: upstreamsubid\n                            }\n                        }\n                        cbPortal.openSection(opts, callbacks);\n                    }else{\n                        var forwardOptions={sectionType: Chargebee.getPortalSections().ACCOUNT_DETAILS};\n                       // cbPortal.open(callbacks,forwardOptions);\n                        cbPortal.open(callbacks);\n                    }\n\n                });//on manage subscription click\n\n            });//end of get script\n\n        }//end of reg events\n    };//end of returned object\n});//total end\n\n"],"file":"chargebeehelper.min.js"}