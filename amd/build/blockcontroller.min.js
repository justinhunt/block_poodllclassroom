define("block_poodllclassroom/blockcontroller",["jquery","core/config","core/log","core/ajax","core/templates","core/modal_factory","core/str","core/modal_events","block_poodllclassroom/dialogs","block_poodllclassroom/datatables","block_poodllclassroom/modalformhelper","block_poodllclassroom/modaldeletehelper","core/notification"],(function($,cfg,log,Ajax,templates,ModalFactory,str,ModalEvents,dialogs,datatables,mfh,mdh,notification){return log.debug("blockcontroller: initialising"),{controls:{},modulecssclass:null,contextid:0,strings:[],subinfo:{},init:function(props){var optscontrol=$("#"+props.id).get(0);if(optscontrol){var opts=JSON.parse(optscontrol.value);$(optscontrol).remove(),this.modulecssclass=opts.modulecssclass,this.contextid=opts.contextid,this.tableid=opts.tableid,this.subinfo=opts.subinfo,this.schoolplan=opts.schoolplan,this.prepare_html(),this.register_events(),this.check_user_count(),this.check_course_count()}else log.debug("Poodll classroom Controller: No config found on page. Giving up.")},init_strings:function(){for(var that=this,strings=["createcourse"],i=0;i<strings.length;i++)str.get_string(strings[i],"block_poodllclassroom").then((function(stringdata){that.strings[i]=stringdata}))},prepare_html:function(){this.controls.createuserstartbutton=$("#"+this.modulecssclass+"_createuser_btn"),this.controls.uploaduserstartbutton=$("#"+this.modulecssclass+"_uploaduser_btn"),this.controls.createcoursestartbutton=$("#"+this.modulecssclass+"_createcourse_btn"),this.controls.createcoursestartcontainer=$("#"+this.modulecssclass+"_createcourse_cnt"),this.controls.nocoursescontainer=$("."+this.modulecssclass+"_nocourses_cont"),this.controls.coursescontainer=$("."+this.modulecssclass+"_courselist_cont"),this.controls.nouserscontainer=$("."+this.modulecssclass+"_nousers_cont"),this.controls.userscontainer=$("."+this.modulecssclass+"_userlist_cont"),this.controls.theusertable=datatables.getDataTable(this.tableid),this.controls.createcoursestartbutton.show(),log.debug(this.controls)},register_events:function(){var that=this;mfh.init("#"+this.modulecssclass+"_createuser_btn",this.contextid,"createuser",(function(item,itemid){log.debug("after user add"),log.debug(item),item.id=itemid,item.lastaccess="--:--",templates.render("block_poodllclassroom/userlistrow",item).then((function(html,js){that.controls.theusertable.row.add($(html)[0]).draw(),that.check_user_count()})),that.controls.nouserscontainer.hide(),that.controls.userscontainer.show()})),mfh.init("#"+this.modulecssclass+"_uploaduser_btn",this.contextid,"uploaduser",(function(){log.debug("after user upload"),document.location.reload()})),mfh.init("#"+this.modulecssclass+"_createcourse_btn",this.contextid,"createcourse",(function(item,itemid){log.debug("after course add"),log.debug(item),item.id=itemid,item.wwwroot=cfg.wwwroot,item.coursename=item.fullname,templates.render("block_poodllclassroom/courseitem",item).then((function(html,js){that.controls.coursescontainer.append($(html)[0]),that.check_course_count()})),that.controls.nocoursescontainer.addClass("block_poodllclassroom_hidden"),that.controls.coursescontainer.removeClass("block_poodllclassroom_hidden")})),mfh.init("."+this.modulecssclass+"_usereditlink",this.contextid,"edituser",(function(item,itemid){var therow="#"+that.modulecssclass+"_user_row_"+itemid;that.controls.theusertable.cell($(therow+" .c0")).data(item.firstname),that.controls.theusertable.cell($(therow+" .c1")).data(item.lastname)})),mfh.init("."+this.modulecssclass+"_courseeditlink",this.contextid,"editcourse",(function(item,itemid){var tileselector="#"+that.modulecssclass+"_courseitem_"+itemid,coursenameselector="."+that.modulecssclass+"_coursename";$(tileselector+" "+coursenameselector).text(item.fullname)})),mdh.init("."+this.modulecssclass+"_coursedeletelink",this.contextid,"deletecourse",(function(itemid){log.debug("after course delete"),$("#"+that.modulecssclass+"_courseitem_"+itemid).remove(),$("div."+that.modulecssclass+"_courseitem").length||(that.controls.nocoursescontainer.removeClass("block_poodllclassroom_hidden"),that.controls.coursescontainer.addClass("block_poodllclassroom_hidden")),that.check_course_count()})),mdh.init("."+this.modulecssclass+"_userdeletelink",this.contextid,"deleteuser",(function(itemid){log.debug("after user delete"),that.controls.theusertable.row("#"+that.modulecssclass+"_user_row_"+itemid).remove().draw(),that.controls.theusertable.rows().count()||(that.controls.nouserscontainer.show(),that.controls.userscontainer.hide()),that.check_user_count()}))},check_course_count:function(){var coursecount=$("."+this.modulecssclass+"_courseitem").length;this.schoolplan.maxcourses>coursecount?this.set_enabled(this.controls.createcoursestartbutton,!0):this.set_enabled(this.controls.createcoursestartbutton,!1)},check_user_count:function(){var usercount=$("."+this.modulecssclass+"_user_row").length;this.schoolplan.maxusers>usercount?(this.set_enabled(this.controls.createuserstartbutton,!0),this.set_enabled(this.controls.uploaduserstartbutton,!0)):(this.set_enabled(this.controls.createuserstartbutton,!1),this.set_enabled(this.controls.uploaduserstartbutton,!1))},set_enabled:function(elem,enabled){switch(enabled){case!0:elem.removeClass("disabled"),elem.attr("aria-disabled","false"),elem.attr("tabindex","0");break;case!1:elem.addClass("disabled"),elem.attr("aria-disabled","true"),elem.attr("tabindex","-1")}},format_date:function(timestamp){var d=new Date(1e3*timestamp),month=""+(d.getMonth()+1),day=""+d.getDate(),year=d.getFullYear();return month.length<2&&(month="0"+month),day.length<2&&(day="0"+day),[year,month,day].join("-")}}}));

//# sourceMappingURL=blockcontroller.min.js.map