define ("block_poodllclassroom/blockcontroller",["jquery","core/config","core/log","core/ajax","core/templates","core/modal_factory","core/str","core/modal_events","block_poodllclassroom/dialogs","block_poodllclassroom/datatables","block_poodllclassroom/modalformhelper","block_poodllclassroom/modaldeletehelper","core/notification"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";c.debug("blockcontroller: initialising");return{controls:{},modulecssclass:null,contextid:0,strings:[],schoolinfo:{},init:function init(b){var d=a("#"+b.id).get(0);if(d){var e=JSON.parse(d.value);a(d).remove()}else{c.debug("Poodll classroom Controller: No config found on page. Giving up.");return}this.modulecssclass=e.modulecssclass;this.contextid=e.contextid;this.tableid=e.tableid;this.schoolinfo=e.schoolinfo;this.schoolplan=e.schoolplan;this.prepare_html();this.register_events()},init_strings:function init_strings(){for(var a=this,b=["createcourse"],c=0;c<b.length;c++){g.get_string(b[c],"block_poodllclassroom").then(function(b){a.strings[c]=b})}},prepare_html:function prepare_html(){this.controls.createuserstartbutton=a("#"+this.modulecssclass+"_createuser_btn");this.controls.createcoursestartbutton=a("#"+this.modulecssclass+"_createcourse_btn");this.controls.createcoursestartcontainer=a("#"+this.modulecssclass+"_createcourse_cnt");this.controls.nocoursescontainer=a("."+this.modulecssclass+"_nocourses_cont");this.controls.coursescontainer=a("."+this.modulecssclass+"_courselist_cont");this.controls.nouserscontainer=a("."+this.modulecssclass+"_nousers_cont");this.controls.userscontainer=a("."+this.modulecssclass+"_userlist_cont");this.controls.theusertable=j.getDataTable(this.tableid);this.controls.createcoursestartbutton.show();c.debug(this.controls)},register_events:function register_events(){var d=this;k.init("#"+this.modulecssclass+"_createuser_btn",this.contextid,"createuser",function after_useradd(b,f){c.debug("after user add");c.debug(b);b.id=f;b.lastaccess="--:--";e.render("block_poodllclassroom/userlistrow",b).then(function(b){d.controls.theusertable.row.add(a(b)[0]).draw()});d.controls.nouserscontainer.hide();d.controls.userscontainer.show();d.check_user_count(d)});k.init("#"+this.modulecssclass+"_createcourse_btn",this.contextid,"createcourse",function after_courseadd(f,g){c.debug("after course add");c.debug(f);f.id=g;f.wwwroot=b.wwwroot;f.coursename=f.fullname;e.render("block_poodllclassroom/courseitem",f).then(function(b){d.controls.coursescontainer.append(a(b)[0])});d.controls.nocoursescontainer.hide();d.controls.coursescontainer.show();d.check_user_count(d)});k.init("."+this.modulecssclass+"_usereditlink",this.contextid,"edituser",function after_useredit(b,c){var e="#"+d.modulecssclass+"_user_row_"+c;d.controls.theusertable.cell(a(e+" .c0")).data(b.firstname);d.controls.theusertable.cell(a(e+" .c1")).data(b.lastname)});k.init("."+this.modulecssclass+"_courseeditlink",this.contextid,"editcourse",function after_courseedit(b,c){var e="#"+d.modulecssclass+"_courseitem_"+c,f="."+d.modulecssclass+"_coursename";a(e+" "+f).text(b.fullname)});l.init("."+this.modulecssclass+"_coursedeletelink",this.contextid,"deletecourse",function after_coursedelete(b){c.debug("after course delete");a("#"+d.modulecssclass+"_courseitem_"+b).remove();var e=a("div."+d.modulecssclass+"_courseitem").length;if(!e){d.controls.nocoursescontainer.show();d.controls.coursescontainer.hide()}d.check_course_count(d)});l.init("."+this.modulecssclass+"_userdeletelink",this.contextid,"deleteuser",function after_userdelete(a){c.debug("after user delete");d.controls.theusertable.row("#"+d.modulecssclass+"_user_row_"+a).remove().draw();var b=d.controls.theusertable.rows().count();if(!b){d.controls.nouserscontainer.show();d.controls.userscontainer.hide()}d.check_user_count(d)})},check_course_count:function check_course_count(){var b=a("."+this.modulecssclass+"_courseitem").length;if(this.schoolplan.maxcourses>=b){this.set_enabled(this.createcoursestartbutton,!1)}else{this.set_enabled(this.createcoursestartbutton,!0)}},check_user_count:function check_user_count(){var b=a("."+this.modulecssclass+"_user_row").length;if(this.schoolplan.maxusers>=b){this.set_enabled(this.createuserstartbutton,!1)}else{this.set_enabled(this.createuserstartbutton,!0)}},set_enabled:function set_enabled(a,b){switch(b){case!0:a.removeClass("disabled");a.attr("aria-disabled","false");a.attr("tabindex","0");break;case!1:a.addClass("disabled");a.attr("aria-disabled","true");a.attr("tabindex","-1");}},format_date:function format_date(a){var b=new Date(1e3*a),c=""+(b.getMonth()+1),d=""+b.getDate(),e=b.getFullYear();if(2>c.length)c="0"+c;if(2>d.length)d="0"+d;return[e,c,d].join("-")}}});
//# sourceMappingURL=blockcontroller.min.js.map
