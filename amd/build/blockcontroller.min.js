define ("block_poodllclassroom/blockcontroller",["jquery","core/config","core/log","core/ajax","core/templates","core/modal_factory","core/str","core/modal_events","block_poodllclassroom/dialogs","block_poodllclassroom/datatables","block_poodllclassroom/modalformhelper","block_poodllclassroom/modaldeletehelper","core/notification"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";c.debug("blockcontroller: initialising");return{controls:{},modulecssclass:null,contextid:0,strings:[],init:function init(a){this.modulecssclass=a.modulecssclass;this.contextid=a.contextid;this.tableid=a.tableid;this.prepare_html();this.register_events()},init_strings:function init_strings(){for(var a=this,b=["createcourse"],c=0;c<b.length;c++){g.get_string(b[c],"block_poodllclassroom").then(function(b){a.strings[c]=b})}},prepare_html:function prepare_html(){this.controls.createuserstartbutton=a("#"+this.modulecssclass+"_createuser_btn");this.controls.createcoursestartbutton=a("#"+this.modulecssclass+"_createcourse_btn");this.controls.createcoursestartcontainer=a("#"+this.modulecssclass+"_createcourse_cnt");this.controls.nocoursescontainer=a("."+this.modulecssclass+"_nocourses_cont");this.controls.coursescontainer=a("."+this.modulecssclass+"_courselist_cont");this.controls.nouserscontainer=a("."+this.modulecssclass+"_nousers_cont");this.controls.userscontainer=a("."+this.modulecssclass+"_userlist_cont");this.controls.theusertable=j.getDataTable(this.tableid);this.controls.createcoursestartbutton.show();c.debug(this.controls)},register_events:function register_events(){var b=this;k.init("#"+this.modulecssclass+"_createuser_btn",this.contextid,"createuser",function after_useradd(d,f){c.debug("after user add");c.debug(d);d.id=f;d.lastaccess="--:--";e.render("block_poodllclassroom/userlistrow",d).then(function(c){b.controls.theusertable.row.add(a(c)[0]).draw()});b.controls.nouserscontainer.hide();b.controls.userscontainer.show()});k.init("#"+this.modulecssclass+"_createcourse_btn",this.contextid,"createcourse",function after_courseadd(d,f){c.debug("after course add");c.debug(d);d.id=f;d.coursename=d.fullname;e.render("block_poodllclassroom/courseitem",d).then(function(c){b.controls.coursescontainer.append(a(c)[0])});b.controls.nouserscontainer.hide();b.controls.userscontainer.show()});k.init("."+this.modulecssclass+"_usereditlink",this.contextid,"edituser",function after_useredit(c,d){var e="#"+b.modulecssclass+"_user_row_"+d;b.controls.theusertable.cell(a(e+" .c0")).data(c.firstname);b.controls.theusertable.cell(a(e+" .c1")).data(c.lastname)});k.init("."+this.modulecssclass+"_courseeditlink",this.contextid,"editcourse",function after_courseedit(c,d){var e="#"+b.modulecssclass+"_courseitem_"+d,f="."+b.modulecssclass+"_coursename";a(e+" "+f).text(c.fullname);debugger});l.init("."+this.modulecssclass+"_coursedeletelink",this.contextid,"deletecourse",function after_coursedelete(d){c.debug("after course delete");a("#"+b.modulecssclass+"_courseitem_"+d).remove();var e=a("div."+b.modulecssclass+"_courseitem").length;if(!e){b.controls.nocoursescontainer.show();b.controls.coursescontainer.hide()}});l.init("."+this.modulecssclass+"_userdeletelink",this.contextid,"deleteuser",function after_userdelete(a){c.debug("after user delete");b.controls.theusertable.row("#"+b.modulecssclass+"_user_row_"+a).remove().draw();var d=b.controls.theusertable.rows().count();if(!d){b.controls.nouserscontainer.show();b.controls.userscontainer.hide()}})},format_date:function format_date(a){var b=new Date(1e3*a),c=""+(b.getMonth()+1),d=""+b.getDate(),e=b.getFullYear();if(2>c.length)c="0"+c;if(2>d.length)d="0"+d;return[e,c,d].join("-")},do_resetkey:function do_resetkey(a,e){d.call([{methodname:"block_poodllclassroom_reset_key",args:{moduleid:e},done:function done(d){var e=JSON.parse(d);if(e){switch(e.success){case!0:var f=e.message;a.controls.sharebox.val(b.wwwroot+"/mod/cpassignment/k.php?k="+f);break;case!1:default:if(e.message){c.debug("message: "+e.message)}}}},fail:m.exception}])},do_delete:function do_delete(a){d.call([{methodname:"block_poodllclassroom_remove_rec",args:{itemid:a},done:function done(a){var b=JSON.parse(a);if(b){switch(b.success){case!0:break;case!1:default:if(b.message){c.debug("message: "+b.message)}}}},fail:m.exception}])},insert_new_item:function insert_new_item(b,c){b.controls.noitemscontainer.hide();b.controls.itemscontainer.show();e.render("block_poodllclassroom/userlistrow",c).then(function(c){b.controls.thedatatable.row.add(a(c)[0]).draw()})},send_submission:function send_submission(a,b,e,f){var g=this,h={subid:a,filename:b,itemname:f,itemid:e,cmid:g.cmid};if("guest"===this.authmode){h.accesskey=g.accesskey}else{h.accesskey="none"}d.call([{methodname:"block_poodllclassroom_submit_rec",args:h,done:function done(a){var b=JSON.parse(a);if(b){switch(b.success){case!0:var d=b.item;if("guest"===g.authmode){g.acknowledge_receipt(g,d)}else{g.insert_new_item(g,d);g.check_item_count(g)}i.closeModal("#"+g.modulecssclass+"_arec_container");g.re_init_recorder(g,g.audiorecid);break;case!1:default:if(b.message){c.debug("message: "+b.message)}i.closeModal("#"+g.modulecssclass+"_arec_container");g.clear_recorder();g.re_init_recorder(g.audiorecid);}}},fail:m.exception}])}}});
//# sourceMappingURL=blockcontroller.min.js.map
