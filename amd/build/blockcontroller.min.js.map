{"version":3,"sources":["../src/blockcontroller.js"],"names":["define","$","cfg","log","Ajax","templates","ModalFactory","str","ModalEvents","dialogs","datatables","mfh","mdh","debug","controls","modulecssclass","contextid","strings","schoolinfo","init","props","optscontrol","id","get","opts","JSON","parse","value","remove","tableid","schoolplan","prepare_html","register_events","check_user_count","check_course_count","init_strings","that","i","length","get_string","then","stringdata","createuserstartbutton","uploaduserstartbutton","createcoursestartbutton","createcoursestartcontainer","nocoursescontainer","coursescontainer","nouserscontainer","userscontainer","theusertable","getDataTable","show","after_useradd","item","itemid","lastaccess","render","html","row","add","draw","hide","after_userupload","document","location","reload","after_courseadd","wwwroot","coursename","fullname","append","addClass","removeClass","after_useredit","therow","cell","data","firstname","lastname","after_courseedit","tileselector","coursenameselector","text","after_coursedelete","itemcount","after_userdelete","rows","count","coursecount","maxcourses","set_enabled","usercount","maxusers","elem","enabled","attr","format_date","timestamp","d","Date","month","getMonth","day","getDate","year","getFullYear","join"],"mappings":"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","sourcesContent":["define(['jquery','core/config','core/log','core/ajax','core/templates','core/modal_factory','core/str','core/modal_events',\n    'block_poodllclassroom/dialogs','block_poodllclassroom/datatables','block_poodllclassroom/modalformhelper','block_poodllclassroom/modaldeletehelper','core/notification'],\n    function($,cfg,log,Ajax, templates, ModalFactory, str, ModalEvents,  dialogs, datatables, mfh, mdh, notification) {\n    \"use strict\"; // jshint ;_;\n\n    log.debug('blockcontroller: initialising');\n\n    return {\n        controls: {},\n        modulecssclass: null,\n        contextid: 0,\n        strings: [],\n        schoolinfo: {},\n\n\n        init: function(props){\n            //pick up opts from html\n            var optscontrol = $('#' + props.id).get(0);\n            if (optscontrol) {\n                var opts = JSON.parse(optscontrol.value);\n                $(optscontrol).remove();\n            } else {\n                //if there is no config we might as well give up\n                log.debug('Poodll classroom Controller: No config found on page. Giving up.');\n                return;\n            }\n\n            this.modulecssclass = opts.modulecssclass;\n            this.contextid = opts.contextid;\n            this.tableid = opts.tableid;\n            this.schoolinfo = opts.schoolinfo;\n            this.schoolplan = opts.schoolplan;\n            this.prepare_html();\n            this.register_events();\n            this.check_user_count();\n            this.check_course_count();\n        },\n\n        init_strings: function(){\n            var that = this;\n           var strings=['createcourse'];\n           for(var i=0; i<strings.length; i++) {\n               str.get_string(strings[i],'block_poodllclassroom').then(function (stringdata) {\n                   that.strings[i]=stringdata;\n               });\n           }\n        },\n\n        prepare_html: function(){\n            this.controls.createuserstartbutton = $('#' + this.modulecssclass + '_createuser_btn');\n            this.controls.uploaduserstartbutton = $('#' + this.modulecssclass + '_uploaduser_btn');\n            this.controls.createcoursestartbutton = $('#' + this.modulecssclass + '_createcourse_btn');\n            this.controls.createcoursestartcontainer = $('#' + this.modulecssclass +'_createcourse_cnt');\n            this.controls.nocoursescontainer = $('.' + this.modulecssclass + '_nocourses_cont');\n            this.controls.coursescontainer = $('.' + this.modulecssclass + '_courselist_cont');\n            this.controls.nouserscontainer = $('.' + this.modulecssclass + '_nousers_cont');\n            this.controls.userscontainer = $('.' + this.modulecssclass + '_userlist_cont');\n            this.controls.theusertable = datatables.getDataTable(this.tableid);\n            this.controls.createcoursestartbutton.show();\n            log.debug(this.controls);\n\n        },\n\n        register_events: function(){\n            var that =this;\n            //modal form helper\n            var after_useradd= function(item, itemid) {\n                log.debug('after user add');\n                log.debug(item);\n                item.id=itemid;\n                item.lastaccess = '--:--';\n                templates.render('block_poodllclassroom/userlistrow',item).then(\n                    function(html,js){\n                        that.controls.theusertable.row.add($(html)[0]).draw();\n                        //can we now add users where before we could not?\n                        that.check_user_count();\n                    }\n                );\n                that.controls.nouserscontainer.hide();\n                that.controls.userscontainer.show();\n\n            };\n            var after_userupload= function() {\n                log.debug('after user upload');\n                //Its cheating a bit, but lets just reload\n                document.location.reload();\n            };\n            var after_courseadd= function(item, itemid) {\n                log.debug('after course add');\n                log.debug(item);\n                item.id = itemid;\n                item.wwwroot = cfg.wwwroot;\n                item.coursename = item.fullname;\n                templates.render('block_poodllclassroom/courseitem',item).then(\n                    function(html,js){\n                        that.controls.coursescontainer.append($(html)[0]);\n                        //can we now add users where before we could not?\n                        that.check_course_count();\n                    }\n                );\n\n                that.controls.nocoursescontainer.addClass('block_poodllclassroom_hidden');\n                that.controls.coursescontainer.removeClass('block_poodllclassroom_hidden');\n\n            };\n            var after_useredit= function(item, itemid) {\n                var therow = '#' + that.modulecssclass + '_user_row_' + itemid;\n                //c0 = firstname c1= lastname c2=lastaccess\n                that.controls.theusertable.cell($(therow + ' .c0')).data(item.firstname);\n                that.controls.theusertable.cell($(therow + ' .c1')).data(item.lastname);\n            };\n            var after_courseedit= function(item, itemid) {\n                var tileselector = '#' + that.modulecssclass + '_courseitem_' + itemid;\n                var coursenameselector = '.' + that.modulecssclass + '_coursename';\n                $(tileselector + ' ' + coursenameselector).text(item.fullname);\n            };\n\n\n            //modal delete helper\n            var after_coursedelete= function(itemid) {\n                log.debug('after course delete');\n                $('#' + that.modulecssclass + '_courseitem_' + itemid).remove();\n                var itemcount = $('div.' + that.modulecssclass + '_courseitem').length;\n                if(!itemcount){\n                    that.controls.nocoursescontainer.removeClass('block_poodllclassroom_hidden');\n                    that.controls.coursescontainer.addClass('block_poodllclassroom_hidden');\n                }\n                //can we now add courses where before we could not?\n                that.check_course_count();\n            };\n            var after_userdelete= function(itemid) {\n                log.debug('after user delete');\n                that.controls.theusertable.row('#' + that.modulecssclass + '_user_row_' + itemid).remove().draw();\n                var itemcount = that.controls.theusertable.rows().count();\n                if(!itemcount){\n                    that.controls.nouserscontainer.show();\n                    that.controls.userscontainer.hide();\n                }\n                //can we now add users where before we could not?\n                that.check_user_count();\n            };\n\n            //form helper\n            mfh.init('#' + this.modulecssclass + '_createuser_btn', this.contextid, 'createuser',after_useradd);\n            mfh.init('#' + this.modulecssclass + '_uploaduser_btn', this.contextid, 'uploaduser',after_userupload);\n            mfh.init('#' + this.modulecssclass + '_createcourse_btn', this.contextid, 'createcourse', after_courseadd);\n            mfh.init('.' + this.modulecssclass + '_usereditlink', this.contextid, 'edituser', after_useredit);\n            mfh.init('.' + this.modulecssclass + '_courseeditlink', this.contextid, 'editcourse', after_courseedit);\n\n            //delete helper\n            mdh.init('.' + this.modulecssclass + '_coursedeletelink', this.contextid, 'deletecourse',after_coursedelete);\n            mdh.init('.' + this.modulecssclass + '_userdeletelink', this.contextid, 'deleteuser',after_userdelete);\n\n        }, //en of reg events\n\n        check_course_count: function(){\n            var coursecount = $('.' + this.modulecssclass + '_courseitem').length;\n            if(this.schoolplan.maxcourses > coursecount) {\n                this.set_enabled(this.controls.createcoursestartbutton,true);\n            }else{\n                this.set_enabled(this.controls.createcoursestartbutton,false);\n            }\n        },\n\n        check_user_count: function(){\n            var usercount = $('.' + this.modulecssclass + '_user_row').length;\n            if(this.schoolplan.maxusers > usercount) {\n                this.set_enabled(this.controls.createuserstartbutton,true);\n                this.set_enabled(this.controls.uploaduserstartbutton,true);\n            }else{\n                this.set_enabled(this.controls.createuserstartbutton,false);\n                this.set_enabled(this.controls.uploaduserstartbutton,false);\n            }\n        },\n\n        set_enabled: function (elem, enabled){\n            switch(enabled){\n                case true:\n                    elem.removeClass('disabled');\n                    elem.attr('aria-disabled','false');\n                    elem.attr('tabindex','0');\n                    break;\n                case false:\n                    elem.addClass('disabled');\n                    elem.attr('aria-disabled','true');\n                    elem.attr('tabindex','-1');\n            }\n        },\n\n        format_date: function(timestamp) {\n                var d = new Date(timestamp * 1000);\n               var month = '' + (d.getMonth() + 1),\n                day = '' + d.getDate(),\n                year = d.getFullYear();\n\n            if (month.length < 2)\n                month = '0' + month;\n            if (day.length < 2)\n                day = '0' + day;\n\n            return [year, month, day].join('-');\n        }\n    };//end of return object\n\n});"],"file":"blockcontroller.min.js"}