{"version":3,"sources":["../src/blockcontroller.js"],"names":["define","$","cfg","log","Ajax","templates","ModalFactory","str","ModalEvents","dialogs","datatables","mfh","mdh","notification","debug","controls","modulecssclass","contextid","strings","init","props","tableid","prepare_html","register_events","init_strings","that","i","length","get_string","then","stringdata","createuserstartbutton","createcoursestartbutton","createcoursestartcontainer","nocoursescontainer","coursescontainer","nouserscontainer","userscontainer","theusertable","getDataTable","show","after_useradd","item","itemid","id","render","html","row","add","draw","hide","after_courseadd","coursename","fullname","append","after_useredit","after_courseedit","after_coursedelete","remove","itemcount","after_userdelete","rows","count","do_resetkey","moduleid","call","methodname","args","done","ajaxresult","payloadobject","JSON","parse","success","accesskey","message","sharebox","val","wwwroot","fail","exception","do_delete","insert_new_item","noitemscontainer","itemscontainer","thedatatable","send_submission","subid","filename","itemname","cmid","authmode","acknowledge_receipt","check_item_count","closeModal","re_init_recorder","audiorecid","clear_recorder"],"mappings":"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","sourcesContent":["define(['jquery','core/config','core/log','core/ajax','core/templates','core/modal_factory','core/str','core/modal_events',\n    'block_poodllclassroom/dialogs','block_poodllclassroom/datatables','block_poodllclassroom/modalformhelper','block_poodllclassroom/modaldeletehelper','core/notification'],\n    function($,cfg,log,Ajax, templates, ModalFactory, str, ModalEvents,  dialogs, datatables, mfh, mdh, notification) {\n    \"use strict\"; // jshint ;_;\n\n    log.debug('blockcontroller: initialising');\n\n    return {\n        controls: {},\n        modulecssclass: null,\n        contextid: 0,\n        strings: [],\n\n\n        init: function(props){\n            this.modulecssclass = props.modulecssclass;\n            this.contextid = props.contextid;\n            this.tableid = props.tableid;\n            this.prepare_html();\n            this.register_events();\n        },\n\n        init_strings: function(){\n            var that = this;\n           var strings=['createcourse'];\n           for(var i=0; i<strings.length; i++) {\n               str.get_string(strings[i],'block_poodllclassroom').then(function (stringdata) {\n                   that.strings[i]=stringdata;\n               });\n           }\n        },\n\n        prepare_html: function(){\n            this.controls.createuserstartbutton = $('#' + this.modulecssclass + '_createuser_btn');\n            this.controls.createcoursestartbutton = $('#' + this.modulecssclass + '_createcourse_btn');\n            this.controls.createcoursestartcontainer = $('#' + this.modulecssclass +'_createcourse_cnt');\n            this.controls.nocoursescontainer = $('.' + this.modulecssclass + '_nocourses_cont');\n            this.controls.coursescontainer = $('.' + this.modulecssclass + '_courselist_cont');\n            this.controls.nouserscontainer = $('.' + this.modulecssclass + '_nousers_cont');\n            this.controls.userscontainer = $('.' + this.modulecssclass + '_userlist_cont');\n            this.controls.theusertable = datatables.getDataTable(this.tableid);\n            this.controls.createcoursestartbutton.show();\n            log.debug(this.controls);\n\n        },\n\n        register_events: function(){\n            var that =this;\n            //modal form helper\n            var after_useradd= function(item, itemid) {\n                log.debug('after user add');\n                log.debug(item);\n                item.id=itemid;\n                templates.render('block_poodllclassroom/userlistrow',item).then(\n                    function(html,js){\n                        that.controls.theusertable.row.add($(html)[0]).draw();\n                    }\n                );\n                that.controls.nouserscontainer.hide();\n                that.controls.userscontainer.show();\n                //can we now add users where before we could not?\n                // that.check_user_count(that);\n            };\n            var after_courseadd= function(item, itemid) {\n                log.debug('after course add');\n                log.debug(item);\n                item.id = itemid;\n                item.coursename = item.fullname;\n                templates.render('block_poodllclassroom/courseitem',item).then(\n                    function(html,js){\n                        that.controls.coursescontainer.append($(html)[0]);\n                    }\n                );\n                that.controls.nouserscontainer.hide();\n                that.controls.userscontainer.show();\n                //can we now add users where before we could not?\n                // that.check_user_count(that);\n            };\n            var after_useredit= function(item, itemid) {};\n            var after_courseedit= function(item, itemid) {};\n\n            //modal delete helper\n            var after_coursedelete= function(itemid) {\n                log.debug('after course delete');\n                $('#' + that.modulecssclass + '_courseitem_' + itemid).remove();\n                var itemcount = $('div.' + that.modulecssclass + '_courseitem').length;\n                if(!itemcount){\n                    that.controls.nocoursescontainer.show();\n                    that.controls.coursescontainer.hide();\n                }\n                //can we now add courses where before we could not?\n                //that.check_course_count(that);\n            };\n            var after_userdelete= function(itemid) {\n                log.debug('after user delete');\n                that.controls.theusertable.row('#' + that.modulecssclass + '_user_row_' + itemid).remove().draw();\n                var itemcount = that.controls.theusertable.rows().count();\n                if(!itemcount){\n                    that.controls.nouserscontainer.show();\n                    that.controls.userscontainer.hide();\n                }\n                //can we now add users where before we could not?\n                // that.check_user_count(that);\n            };\n\n            //form helper\n            mfh.init('#' + this.modulecssclass + '_createuser_btn', this.contextid, 'createuser',after_useradd);\n            mfh.init('#' + this.modulecssclass + '_createcourse_btn', this.contextid, 'createcourse', after_courseadd);\n            mfh.init('.' + this.modulecssclass + '_usereditlink', this.contextid, 'edituser', after_useredit);\n            mfh.init('.' + this.modulecssclass + '_courseeditlink', this.contextid, 'editcourse', after_courseedit);\n\n            //delete helper\n            mdh.init('.' + this.modulecssclass + '_coursedeletelink', this.contextid, 'deletecourse',after_coursedelete);\n            mdh.init('.' + this.modulecssclass + '_userdeletelink', this.contextid, 'deleteuser',after_userdelete);\n\n            //modal dialog show link\n            /*\n            this.controls.createcoursestartbutton.click(function(){\n                dialogs.openModal('#' + that.modulecssclass + '_createcourse_cnt');\n                log.debug('opened modal');\n                return false;\n            });\n\n            */\n\n\n            //download links\n            /*\n            this.controls.rectable.on('click','a[data-type=\"download\"]',function(e){\n                    var clickedLink = $(e.currentTarget);\n                    var elementid = clickedLink.data('id');\n                    that.show_download(that, elementid);\n                    return false;\n            });\n            */\n\n            //delete linkc\n            /*\n            this.controls.rectable.on('click','a[data-type=\"delete\"]',function(e){\n                        var clickedLink = $(e.currentTarget);\n                        var elementid = clickedLink.data('id');\n                        var audiotitle = $('td.itemname span[data-itemid=\"'+ elementid+ '\"]').data('value');\n                        ModalFactory.create({\n                            type: ModalFactory.types.SAVE_CANCEL,\n                            title: 'Delete Media',\n                            body: 'Do you really want to delete audio? <i>' + audiotitle + '</i>',\n                        })\n                            .then(function(modal) {\n                                modal.setSaveButtonText('DELETE');\n                                var root = modal.getRoot();\n                                root.on(ModalEvents.save, function() {\n                                    that.controls.thedatatable.row( clickedLink.parents('tr')).remove().draw();\n                                    var itemcount = that.controls.thedatatable.rows().count();\n                                    if(!itemcount){\n                                        that.controls.noitemscontainer.show();\n                                        that.controls.itemscontainer.hide();\n                                    }\n                                    that.do_delete(elementid);\n                                    that.check_item_count(that);\n                                });\n                                modal.show();\n                            });\n                        return false;\n            });\n            */\n        }, //en of reg events\n\n        do_resetkey: function(that, moduleid){\n\n            Ajax.call([{\n                methodname: 'block_poodllclassroom_reset_key',\n                args: {\n                    moduleid: moduleid,\n                },\n                done: function (ajaxresult) {\n                    var payloadobject = JSON.parse(ajaxresult);\n                    if (payloadobject) {\n                        switch(payloadobject.success) {\n                            case true:\n                                var accesskey = payloadobject.message;\n                                that.controls.sharebox.val(cfg.wwwroot + '/mod/cpassignment/k.php?k=' + accesskey);\n                                break;\n\n                            case false:\n                            default:\n                                if (payloadobject.message) {\n                                    log.debug('message: ' + payloadobject.message);\n                                }\n                        }\n                    }\n                },\n                fail: notification.exception\n            }]);\n\n        },\n\n        do_delete: function(itemid){\n\n            Ajax.call([{\n                methodname: 'block_poodllclassroom_remove_rec',\n                args: {\n                    itemid: itemid,\n                },\n                done: function (ajaxresult) {\n                    var payloadobject = JSON.parse(ajaxresult);\n                    if (payloadobject) {\n                        switch(payloadobject.success) {\n                            case true:\n                                //all good do nothing\n                                break;\n\n                            case false:\n                            default:\n                                if (payloadobject.message) {\n                                    log.debug('message: ' + payloadobject.message);\n                                }\n                        }\n                    }\n                },\n                fail: notification.exception\n            }]);\n\n        },\n\n\n\n        insert_new_item: function(that,item){\n            that.controls.noitemscontainer.hide();\n            that.controls.itemscontainer.show();\n            templates.render('block_poodllclassroom/userlistrow',item).then(\n                function(html,js){\n                    that.controls.thedatatable.row.add($(html)[0]).draw();\n                }\n            );\n        },\n\n\n\n        send_submission: function(subid,filename, itemid, itemname ){\n            var that=this;\n            var args = {\n                    subid: subid,\n                    filename: filename,\n                    itemname: itemname,\n                    itemid: itemid,\n                    cmid: that.cmid\n                };\n            if(this.authmode==='guest'){\n                args.accesskey=that.accesskey;\n            }else{\n                args.accesskey='none';\n            }\n\n            Ajax.call([{\n                methodname: 'block_poodllclassroom_submit_rec',\n                args: args,\n                done: function (ajaxresult) {\n                    var payloadobject = JSON.parse(ajaxresult);\n                    if (payloadobject) {\n                        switch(payloadobject.success) {\n                            case true:\n                                var item = payloadobject.item;\n                                if(that.authmode==='guest'){\n                                    that.acknowledge_receipt(that,item);\n                                }else{\n                                    that.insert_new_item(that,item);\n                                    that.check_item_count(that);\n                                }\n\n                                dialogs.closeModal('#' + that.modulecssclass + '_arec_container');\n                                that.re_init_recorder(that,that.audiorecid);\n                                break;\n\n                            case false:\n                            default:\n                                if (payloadobject.message) {\n                                    log.debug('message: ' + payloadobject.message);\n                                }\n                                dialogs.closeModal('#' + that.modulecssclass + '_arec_container');\n                                that.clear_recorder();\n                                that.re_init_recorder(that.audiorecid);\n\n                        }\n                    }\n                },\n                fail: notification.exception\n            }]);\n\n        },\n    };//end of return object\n\n});"],"file":"blockcontroller.min.js"}